# Сборка APK для Android (БЮРО ЭКСПЕРТОВ)

Приложение на телефоне — тот же интерфейс, что и в браузере/десктопе. Данные синхронизируются через **общий сервер**: и десктоп, и Android подключаются к одному бэкенду.

---

## Сборка через GitHub (без Android Studio)

1. Закоммитьте и **запушьте** проект в GitHub (должна быть папка `.github/workflows` с файлом `build-android-apk.yml`).
2. Откройте репозиторий на **GitHub** → вкладка **Actions**.
3. Слева выберите workflow **«Build Android APK»**.
4. Нажмите **Run workflow** (справа) → **Run workflow**.
5. Дождитесь окончания (зелёная галочка). Откройте последний запуск.
6. Внизу страницы в блоке **Artifacts** скачайте **bureau-expertov-apk** — внутри архив с файлом **app-debug.apk**.

Workflow также запускается автоматически при каждом пуше в ветки `main` или `master`.

---

## Сборка на своём компьютере (через Android Studio)

### Что нужно установить

1. **Node.js** (уже есть, если собирали фронт)
2. **Android Studio** — [developer.android.com/studio](https://developer.android.com/studio)  
   При установке установите Android SDK (в т.ч. API 22+).
3. **JDK 17** — обычно ставится с Android Studio.

### Шаги сборки APK

1. Установить зависимости и добавить Android

В папке `bureau-app`:

```bash
npm install
npm run build
npx cap add android
```

Если платформа `android` уже добавлена, достаточно:

```bash
npm run build:android
```

2. Открыть проект в Android Studio

```bash
npx cap open android
```

Или вручную: папка `bureau-app/android`.

3. Собрать APK в Android Studio

- Меню **Build** → **Build Bundle(s) / APK(s)** → **Build APK(s)**.
- Готовый APK: `bureau-app/android/app/build/outputs/apk/debug/app-debug.apk`  
  (для release: **Build** → **Generate Signed Bundle / APK** и настроить подпись.)

4. Установка на телефон

Скопируйте `app-debug.apk` на телефон и откройте файл (разрешите установку из неизвестных источников при запросе).

---

## Подключение к серверу и синхронизация

1. **Сервер**: бэкенд должен быть доступен по сети (компьютер с exe, VPS, свой сервер). Запустите бэкенд и откройте порт (например 8765). Для доступа с телефона нужен URL вида `http://ВАШ_IP:8765` или `https://ваш-домен.ru`.

2. **В приложении на телефоне**:  
   **Настройки** (в меню) → вкладка **Подключение к серверу** → включите «Использовать общий сервер» и введите URL сервера (без слэша в конце) → **Проверить** → **Сохранить**.

3. **Вход**: те же логин/пароль, что на десктопе (например `admin` / `админ`). Данные (клиенты, сделки, документы и т.д.) общие — всё синхронизируется через сервер.

---

## Повторная сборка после изменений во фронте

```bash
cd bureau-app
npm run build:android
npx cap open android
```

В Android Studio снова **Build** → **Build APK(s)**.

---

## Режимы работы

| Режим        | Где работает | Данные |
|-------------|--------------|--------|
| Десктоп exe | Локально     | Локальная БД на ПК или подключение к серверу (Настройки). |
| Android APK | Телефон      | Только через сервер: в Настройках укажите URL сервера. |
| Синхронизация | Десктоп и Android с одним и тем же сервером и одним аккаунтом | Общая база на сервере. |
